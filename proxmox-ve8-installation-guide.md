# Proxmox VE 8 安装指南

## 目录
- [简介](#简介)
- [硬件需求](#硬件需求)
- [安装前准备](#安装前准备)
- [安装步骤](#安装步骤)
  - [引导安装程序](#引导安装程序)
  - [安装选项配置](#安装选项配置)
  - [网络配置](#网络配置)
  - [存储配置](#存储配置)
  - [用户设置](#用户设置)
  - [总结确认](#总结确认)
- [安装后配置](#安装后配置)
  - [访问 Web 界面](#访问-web-界面)
  - [存储池配置](#存储池配置)
  - [网络设置优化](#网络设置优化)
  - [集群设置](#集群设置)
- [故障排除](#故障排除)
- [最佳实践](#最佳实践)
- [参考资料](#参考资料)

## 简介

Proxmox Virtual Environment (PVE) 8 是一个基于 Debian 的开源服务器虚拟化环境，集成了 KVM 虚拟机、LXC 容器、软件定义存储和网络功能。本指南详细介绍 Proxmox VE 8 的安装过程和初始配置，适用于新用户和有经验的系统管理员。

作为 Proxmox VE 系列的最新版本，8.0 版本带来了许多改进和新功能，包括：
- 基于 Debian 12 (Bookworm)
- 内核升级至 Linux 6.5
- QEMU 8.1 和 LXC 5.0 支持
- 更新的 Web UI 界面
- 更好的容器模板管理
- 改进的备份和恢复功能

## 硬件需求

在安装 Proxmox VE 8 之前，请确保您的硬件满足以下最低要求：

| 组件 | 最低要求 | 推荐配置 |
|------|---------|---------|
| CPU | 64位双核处理器 (Intel EMT64 或 AMD64) | 多核心处理器，支持虚拟化扩展 (Intel VT-x/AMD-V) |
| 内存 | 4 GB RAM | 16 GB RAM 或更多 |
| 硬盘 | 32 GB | 256 GB 或更大的 SSD，额外的存储磁盘 |
| 网卡 | 1 个网络接口 | 2 个或更多网络接口（用于网络冗余和分离） |
| 显示器 | 仅安装时需要 | 安装后可通过 Web 界面管理 |

> **注意**：为了获得最佳性能，强烈建议使用支持硬件虚拟化的 CPU (Intel VT-x/AMD-V) 和足够的 RAM 来运行多个虚拟机。

## 安装前准备

在开始安装之前，请完成以下准备工作：

1. **备份数据**：如果您要在现有系统上安装，务必备份所有重要数据。

2. **下载 ISO 镜像**：
   - 访问 [Proxmox 下载页面](https://www.proxmox.com/en/downloads/proxmox-virtual-environment/iso)
   - 下载最新的 Proxmox VE 8 ISO 镜像
   - 验证下载的 ISO 文件校验和

3. **创建启动媒介**：
   - 参考我们的 [Proxmox VE 安装 U 盘制作指南](proxmox-ve-usb-creation-guide.md) 创建启动 U 盘
   - 或将 ISO 烧录到 DVD 光盘

4. **收集网络信息**：
   - 静态 IP 地址（推荐）
   - 子网掩码
   - 网关地址
   - DNS 服务器地址
   - 主机名（FQDN 格式，例如 pve.example.com）

5. **BIOS 设置**：
   - 启用虚拟化支持 (Intel VT-x/AMD-V 和 VT-d/AMD-Vi)
   - 设置从 USB/DVD 启动

## 安装步骤

### 引导安装程序

1. 将准备好的启动 U 盘或 DVD 插入服务器
2. 启动服务器并设置从 USB/DVD 引导
3. 在 Proxmox VE 引导菜单中，选择 "Install Proxmox VE"
   - 如需使用高级选项，可选择 "Install Proxmox VE (Debug mode)"
   - 对于串行控制台安装，选择相应的串行控制台选项

4. 等待安装程序加载，这可能需要几分钟时间

### 安装选项配置

1. **EULA 协议**：
   - 阅读并接受最终用户许可协议
   - 点击 "I agree" 继续

2. **目标硬盘选择**：
   - 选择要安装 Proxmox VE 的硬盘
   - 选择文件系统类型：
     - **ext4**：传统文件系统，稳定且广泛支持
     - **xfs**：高性能文件系统，适合大型存储
     - **zfs**：提供数据完整性校验、快照等高级功能（需要更多内存）
   - 如选择 ZFS，可配置 RAID 级别：
     - **RAID0**：条带化，提高性能但无冗余
     - **RAID1**：镜像，提供数据冗余
     - **RAID10**：条带化镜像，同时提供性能和冗余
     - **RAIDZ-1/2/3**：类似于 RAID5/6，提供不同级别的冗余

   > **注意**：安装将会擦除目标磁盘上的所有数据！确保已备份重要数据。

3. **地区和时区设置**：
   - 选择您的国家/地区
   - 选择时区
   - 设置键盘布局

### 网络配置

1. **网络接口设置**：
   - 选择要用于管理的网络接口
   - 设置静态 IP 配置（推荐）或 DHCP

2. **主机名设置**：
   - 输入完全限定域名 (FQDN)，例如 `pve.example.com`
   - 系统会自动提取主机名部分 (`pve`)

3. **网络详细信息**：
   - IP 地址：输入您的静态 IP（如 192.168.1.100）
   - 子网掩码：通常为 255.255.255.0（对应 /24）
   - 网关：您网络的默认网关
   - DNS 服务器：可以使用公共 DNS（如 8.8.8.8）或本地 DNS 服务器

### 用户设置

1. **管理员密码设置**：
   - 为 root 用户设置强密码
   - 密码应包含大小写字母、数字和特殊字符

2. **电子邮件配置**：
   - 输入管理员电子邮件地址
   - 此邮箱将用于系统通知和警报

### 总结确认

1. **安装总结**：
   - 查看配置总结，确认所有设置正确
   - 特别检查存储配置，因为此操作将擦除所选磁盘

2. **开始安装**：
   - 点击 "Install" 开始安装过程
   - 系统将格式化磁盘，复制文件并配置系统
   - 安装过程通常需要 5-15 分钟，取决于硬件性能

3. **完成安装**：
   - 安装完成后，系统将显示成功消息和管理界面 URL
   - 记下该 URL（通常为 https://your-ip:8006）
   - 点击 "Reboot" 重启系统

## 安装后配置

### 访问 Web 界面

1. **首次登录**：
   - 在另一台电脑的浏览器中，访问 https://your-ip:8006
   - 接受自签名 SSL 证书警告（可在后续配置中解决）
   - 使用以下凭据登录：
     - 用户名：root
     - 密码：安装时设置的密码
     - 领域：选择 "Proxmox VE authentication server"

2. **订阅通知**：
   - 首次登录会看到企业订阅通知
   - 社区版可以关闭此通知继续使用

### 存储池配置

1. **本地存储**：
   - Proxmox 默认创建 "local" 和 "local-lvm" 存储
   - "local" 用于 ISO 镜像和容器模板
   - "local-lvm" 用于虚拟磁盘和容器

2. **添加额外存储**：
   - 点击 "Datacenter" > "Storage" > "Add"
   - 选择存储类型（NFS, CIFS, iSCSI, Ceph, ZFS 等）
   - 按照向导配置新存储
   - 为存储分配使用类型（虚拟机磁盘、容器、ISO 等）

### 网络设置优化

1. **网桥配置**：
   - Proxmox 默认创建 vmbr0 网桥用于虚拟机网络
   - 若需要多个网络或 VLAN，可在 "System" > "Network" 中添加配置

2. **防火墙设置**：
   - 在 "Datacenter" > "Firewall" 中配置全局防火墙规则
   - 可为集群、节点、虚拟机和容器单独配置规则

### 集群设置

如果计划部署多节点集群：

1. **创建集群**：
   - 在第一个节点上：Datacenter > Cluster > Create Cluster
   - 为集群命名并创建
   - 系统会生成加入信息

2. **添加节点**：
   - 在其他节点上：Datacenter > Cluster > Join Cluster
   - 输入第一个节点信息和加入密码
   - 集群会自动同步配置

## 故障排除

### 常见安装问题

1. **无法引导安装媒介**：
   - 检查 BIOS/UEFI 设置中的启动顺序
   - 尝试重新创建启动媒介
   - 尝试另一个 USB 端口

2. **找不到存储设备**：
   - 确保 RAID 控制器驱动程序受支持
   - 对于较新的硬件，可能需要在高级选项中加载附加驱动程序

3. **网络配置失败**：
   - 确认网线连接正确
   - 验证 IP 地址未被网络中其他设备使用
   - 检查 DNS 设置是否正确

### 安装后问题

1. **无法访问 Web 界面**：
   - 验证 IP 地址和网络配置
   - 检查防火墙设置是否允许 8006 端口
   - 使用 ping 测试网络连接

2. **虚拟化扩展未启用**：
   - 检查 BIOS/UEFI 设置，确保已启用 VT-x/AMD-V
   - 运行 `dmesg | grep -e "kvm" -e "KVM"` 检查 KVM 支持

3. **Web 界面证书警告**：
   - 可以通过配置有效的 SSL 证书解决
   - 考虑使用 Let's Encrypt 或自定义证书

## 最佳实践

1. **安全建议**：
   - 定期更新系统（apt update && apt upgrade）
   - 为 root 账户使用强密码
   - 考虑创建非特权用户进行日常管理
   - 配置 SSH 密钥认证代替密码登录

2. **性能优化**：
   - 对于 ZFS 存储，分配足够内存（总内存的 50% 作为经验法则）
   - 使用 SSD 作为系统盘和缓存设备
   - 为虚拟机和容器分配适当的资源，避免过度分配

3. **备份策略**：
   - 配置定期备份任务
   - 测试备份恢复流程
   - 考虑异地备份关键数据

4. **监控系统**：
   - 启用内置监控功能
   - 配置电子邮件警报
   - 考虑集成外部监控系统（如 Nagios, Grafana）

## 参考资料

- [Proxmox VE 官方文档](https://pve.proxmox.com/pve-docs/)
- [Proxmox VE Wiki](https://pve.proxmox.com/wiki/Main_Page)
- [Proxmox 社区论坛](https://forum.proxmox.com/)
- [Proxmox VE 8.0 发行说明](https://pve.proxmox.com/wiki/Roadmap#Proxmox_VE_8.0) 